# bertron-schema

LinkML schema for BER data integration work

## Website

[https://ber-data.github.io/bertron-schema](https://ber-data.github.io/bertron-schema)

## Repository Structure

* [src/](src/) - source files
    * [sample_data/](src/sample_data/) - example data
    * [schema]
        * [jsonschema](src/schema/jsonschema/) -- autogenerated JSON Schema model
        * [linkml](src/schema/linkml/) -- LinkML schema source files
        * [datamodel](src/schema/datamodel/) -- autogenerated
      Python datamodel

* [tests/](tests/) - Python tests

Edits should be made to the [LinkML source files](src/schema/linkml/) and propagated to other formats using LinkML generators (see below for instructions).

## Developer Documentation

<details>
To run commands you may use `make` or the command runner [just](https://github.com/casey/just/), which is a better choice on Windows.
Use the `make` command or `just` commands to generate project artefacts:
* `make help` or `just --list`: list all pre-defined tasks
* `make all` or `just all`: make everything
* `make deploy` or `just deploy`: deploys site
</details>


## Software Installation

This repo uses [uv](https://docs.astral.sh/uv/) to manage the python environment and dependencies.

See the [uv docs](https://docs.astral.sh/uv/) for uv installation instructions.

Install the project dependencies and create a virtual environment:

```sh
uv sync
```

Run tests or other scripts:

```sh
uv run <command>
uv run pytest tests/
```

### Useful commands

These assume that you have already run `uv sync` to install the schema virtual environment and dependencies.

generate standard repo artefacts (JSON Schema and Pydantic versions of the schema)
```sh
make gen-artefacts
```

generate derived files in all formats and save them to the `project` directory:
```sh
uv run gen-project -d project/ src/schema/linkml/bertron_schema.yaml
```

validate the LinkML schema file:
```sh
uv run linkml-lint --validate src/schema/linkml/bertron_schema.yaml
```

lint the LinkML schema file:
```sh
uv run linkml-lint src/schema/linkml/bertron_schema.yaml
```

validate data (in file `data.yaml`) against the schema:
```sh
uv run linkml-validate -s src/schema/linkml/bertron_schema.yaml data.yaml
```

generate JSON Schema version:
```sh
uv run gen-json-schema src/schema/linkml/bertron_schema.yaml > src/schema/jsonschema/bertron_schema.json
```

generate Python classes:
```sh
uv run gen-python src/schema/linkml/bertron_schema.yaml > src/schema/datamodel/bertron_schema.py
```

generate Pydantic classes:
```sh
uv run gen-pydantic src/schema/linkml/bertron_schema.yaml > src/schema/datamodel/bertron_schema_pydantic.py
```

#### JSON Schema data validation

install the [JSON Schema check](https://check-jsonschema.readthedocs.io/en/latest/) script:

```sh
brew install check-jsonschema
```

or

```sh
pip install check-jsonschema
```

To test a file or files against the schema, use the command:
```sh
check-jsonschema --schemafile src/schema/jsonschema/bertron_schema.json data_file_1.json data_file_2.json
```
or
```sh
check-jsonschema --schemafile src/schema/jsonschema/bertron_schema.json src/sample_data/valid/*.json
```


## Credits

This project was made with
[linkml-project-cookiecutter](https://github.com/linkml/linkml-project-cookiecutter).
